<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/SeaGapDocs/libs/highlight/styles/github.min.css"> <link href="/SeaGapDocs/css/franklin.css" rel=stylesheet > <link href="/SeaGapDocs/css/vela.css" rel=stylesheet > <script src="/SeaGapDocs/libs/vela/jquery.min.js"></script> <link rel=icon  href="/SeaGapDocs/assets/favicon.png"> <title>SeaGapDocs</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>SeaGap Docs</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/SeaGapDocs/index.html">Home</a> <li><a href="/SeaGapDocs/install/">Installation</a> <li><a href="/SeaGapDocs/dataformat/">Dataformat</a> <li><a href="" class=has-arrow >Methodology</a> <ul> <li><a href="/SeaGapDocs/methodoverview/">Overview</a> </ul> <ul> <li><a href="/SeaGapDocs/methodtt/">Travel-time calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/methodkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodsingle/">Individual transponder positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodmcmcpvg/">Static array positioning with gradients</a> </ul> <li><a href="" class=has-arrow >Tutorials</a> <ul> <li><a href="/SeaGapDocs/tutorialforward/">Forward calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialdenoise/">Outlier removal</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialmcmcpvg/">MCMC static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialts/">Line fitting for time-series</a> </ul> <li><a href="/SeaGapDocs/others/">Others</a> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Tutorials</h1> <hr> <div class=franklin-content > <h1 id=outlier_removal ><a href="#outlier_removal" class=header-anchor >Outlier removal</a></h1> <p>GNSS-A data often cotain outliers, especially in travel-time data. Here, a simple noise removal function <code>denoise&#40;&#41;</code> is introduced. This function firstly calculate travel-time residuals and then apply a filter &#40;running median or average filter <code>runmed&#40;&#41;</code> or <code>runave&#40;&#41;</code>&#41; to time-series of the travel-time residuals. After removing the filtered time-series from the original travel-time residual time-series, <code>denoise&#40;&#41;</code> eliminates outliers that beyond the range of muliplied standard deviation. The results of the noise removal are automatically visualized, and you can select to accept the removal or not.</p> <p>First, you have to prepare the basic input files denoted in <a href="/SeaGapDocs/dataformat">Dataformat</a>: &quot;tr-ant.inp&quot;, &quot;pxp-ini.xyh&quot;, &quot;ss&#95;prof.zv&quot;, and &quot;obsdata.inp&quot;.</p> <p>Before performing <code>denoise&#40;&#41;</code>, we calculate travel-time residuals by <code>ttres&#40;lat,XDUCER_DEPTH; fn1,fn2,fn3,fn4,save&#41;</code>. <code>lat</code> is the site latitude, <code>XDUCER_DEPTH</code> is the average depth of a sea-surface transducer &#40;also see <a href="/SeaGapDocs/tutorialforward/">Forward calculation</a>&#41;. <code>fn1</code>, <code>fn2</code>, <code>fn3</code>, and <code>fn4</code> are the file names of &quot;tr-ant.inp&quot;, &quot;pxp-ini.xyh&quot;, &quot;ss&#95;prof.zv&quot;, and &quot;obsdata.inp&quot;. Note that the file names can be optionally changed. If you use the default file names, you do not have to use these arguments.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots
lat = <span class=hljs-number >36.15753</span>; XDUCER_DEPTH = <span class=hljs-number >3.0</span>
nv,kv,t1,t2,tp,tc,tr,vert = SeaGap.ttres(lat,XDUCER_DEPTH)
scatter(t1,tr,markershape=:cross,zcolor=kv,label=:none,c=:rainbow)</code></pre> <p><code>nv</code> is the shot number, <code>kv</code> is the seafloor transponder number, <code>t1</code> is the transmitted time, <code>t2</code> is the receieved time, <code>tp</code> is the observed travel-times, <code>tc</code> is the calculated travel-times assuming the seafloor positions wriiten in &quot;pxp-ini.xyh&quot;, <code>tr</code> is the reavel-time residuals, and <code>vert</code> is the mapping functions &#40;see <a href="/SeaGapDocs/tutorialforward/">Forward calculation</a>&#41;.</p> <p>The plots of the travel-time residuals are obtained by <code>Plots.scatter&#40;&#41;</code> &#40;X: the transmitted time, Y: the travel-time residuals, Color: the seafloor transponder number&#41;.</p> <div class=row > <div class=container > <img src="/SeaGapDocs/assets/ttres.png" width=300  height=300 > <div style="clear: both"></div> </div> </div> <p>The travel-time residuals of the all transponders show a similar trend after the time of 3 hours when the sea-surface platform had been at a fixed point &#40;refer the figures in Dataformat&#41;. This trend is considered to be temporal fluctuation of the sound speed structure, and the offset of the residuals could be caused due to non-optimization of the transponder array position in this calculation. Meanwhile, the travel-time residuals show different trends before the time of 3 hours depending on the sea-surface positions; this generally due to non-optimization of the transponder array position in this calculation and spatial heterogenity of a sound speed structure. From the above figure, you can see several outliers, mostly for the 4th transponder.</p> <p>Then, let&#39;s perform <code>denoise&#40;&#41;</code>. The following is an example to run the function:</p> <pre><code class="julia hljs">lat = <span class=hljs-number >36.15753</span>; XDUCER_DEPTH = <span class=hljs-number >3.0</span>
SeaGap.denoise(lat,XDUCER_DEPTH,k=<span class=hljs-number >0</span>,n=<span class=hljs-number >7</span>,sigma=<span class=hljs-number >4.0</span>,method=<span class=hljs-string >&quot;median&quot;</span>)</code></pre> <p>As well as <code>ttres&#40;&#41;</code>, you can assign the file names by <code>fn1</code>, <code>fn2</code>, <code>fn3</code>, and <code>fn4</code>; they correspond to &quot;tr-ant.inp&quot;, &quot;pxp-ini.xyh&quot;, &quot;ss&#95;prof.zv&quot;, and &quot;obsdata.inp&quot;.</p> <p>After running this in REPL, a figure is shown such as following:</p> <div class=row > <div class=container > <img src="/SeaGapDocs/assets/denoise.png" width=450  height=450 > <div style="clear: both"></div> </div> </div> <p>The blue plots on each left panel show the travel-time residuals of each transponder. The red curve of each left panel indicates the filtered time-series of the travel-time residuals. The filtered time-series is calculated by a running filter &#40;<code>method&#61;&quot;median&quot;</code>: a running median filter, <code>method&#61;&quot;ave&quot;</code>: a running average filter&#41; with a running window of <code>n</code> samples.</p> <p>The right panels show the travel-time residuals subtracting the filtered time-series. The red plots are identified as outliers beyond a range of the <code>sigma</code>-multipled standard deviation.</p> <p>After this prcossing, the following message is shown:</p> <pre><code class="plaintext hljs">Do you accept the denoise processing? (yes/no):</code></pre>
<p>If you type &quot;yes&quot;, &quot;obsdata.inp&quot; &#40;<code>fn4</code>&#41; is replaced with new &quot;obsdata.inp&quot; &#40;<code>fn4</code>&#41; without the outliers. If you type &quot;no&quot;, &quot;obsdata.inp&quot; &#40;<code>fn4</code>&#41; is unchanged. If you&#39;ld like to the orginal &quot;obsdata.inp&quot; when selecting &quot;yes&quot;, you can save the original &quot;obsdata.inp&quot; as <code>fn0</code> &#40;an optional file name&#41; with setting <code>save&#61;true</code>:</p>
<pre><code class="julia hljs">SeaGap.denoise(lat,XDUCER_DEPTH,k=<span class=hljs-number >0</span>,n=<span class=hljs-number >7</span>,sigma=<span class=hljs-number >4.0</span>,method=<span class=hljs-string >&quot;median&quot;</span>,save=<span class=hljs-literal >true</span>,fn0=<span class=hljs-string >&quot;original_obsdata.inp&quot;</span>)</code></pre>
<p>If you&#39;d like to run <code>denoise&#40;&#41;</code> without the above interaction &#40;typing &quot;yes&quot; or &quot;no&quot;&#41;, you should set &quot;prompt&#61;false&quot;. In this case, &quot;obsdata.inp&quot; &#40;<code>fn4</code>&#41; is replaced with new &quot;obsdata.inp&quot; &#40;<code>fn4</code>&#41; without the outliers. Thus, <code>save&#61;true</code> and <code>show&#61;false</code> options are recommended; the original &quot;obsdata.inp&quot; is saved as <code>fn0</code> and the figure is saved as <code>fno2</code>.</p>
<pre><code class="julia hljs">SeaGap.denoise(lat,XDUCER_DEPTH,k=<span class=hljs-number >0</span>,n=<span class=hljs-number >7</span>,sigma=<span class=hljs-number >4.0</span>,method=<span class=hljs-string >&quot;median&quot;</span>,prompt=<span class=hljs-literal >false</span>,save=<span class=hljs-literal >true</span>,fn0=<span class=hljs-string >&quot;original_obsdata.inp&quot;</span>,show=<span class=hljs-literal >false</span>,fno2=<span class=hljs-string >`denoise.png`</span>)</code></pre>
<p>If you set <code>k&#61;0</code>, the outlier removal processing is performed for all transponders. If you set <code>k</code> with the other interger number &#40;such as <code>k&#61;2</code>&#41;, the outlier removal processing is performed for the <code>k</code>th transponder.  </p>
<p>Note that the processing results of <code>denoise&#40;&#41;</code> is also recorded as a text file named <code>fno1</code> &#40;the defalut is <code>fno1&#61;&quot;denoise.out&quot;</code>&#41;, which shows &#40;1: the shot number, 2: the transponder number, 3: the transmitted time &#91;sec&#93;, 4: the travel-time residual, 5: the filtered travel-time residual, 6: difference between &#91;4&#93; and &#91;5&#93;, 7: the outlier identifier &#91;0: remain, 1: outlier&#93;&#41;.</p>
<p>If all outliers are not removed by single performance of <code>denoise&#40;&#41;</code>, you should repeatedly perform <code>denoise&#40;&#41;</code> and obtain cleaned &quot;obsdata.inp&quot;.</p>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Fumiaki Tomita. Last modified: January 24, 2023.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
  </main> 
  <script src="/SeaGapDocs/libs/vela/metisMenu.min.js"></script>
  <script src="/SeaGapDocs/libs/vela/slideout.min.js"></script>
  
  
    <script src="/SeaGapDocs/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>
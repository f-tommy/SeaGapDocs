<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/SeaGapDocs/libs/katex/katex.min.css"> <link rel=stylesheet  href="/SeaGapDocs/libs/highlight/styles/github.min.css"> <link href="/SeaGapDocs/css/franklin.css" rel=stylesheet > <link href="/SeaGapDocs/css/vela.css" rel=stylesheet > <script src="/SeaGapDocs/libs/vela/jquery.min.js"></script> <link rel=icon  href="/SeaGapDocs/assets/favicon.png"> <title>SeaGapDocs</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>SeaGap Docs</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/SeaGapDocs/index.html">Home</a> <li><a href="/SeaGapDocs/install/">Installation</a> <li><a href="/SeaGapDocs/dataformat/">Dataformat</a> <li><a href="" class=has-arrow >Methodology</a> <ul> <li><a href="/SeaGapDocs/methodoverview/">Overview</a> </ul> <ul> <li><a href="/SeaGapDocs/methodtt/">Travel-time calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/methodkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodsingle/">Individual transponder positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodmcmcpvg/">Static array positioning with gradients</a> </ul> <li><a href="" class=has-arrow >Tutorials</a> <ul> <li><a href="/SeaGapDocs/tutorialforward/">Forward calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialdenoise/">Outlier removal</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialmcmcpvg/">MCMC static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialts/">Line fitting for time-series</a> </ul> <li><a href="/SeaGapDocs/others/">Others</a> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Tutorials</h1> <hr> <div class=franklin-content > <h1 id=forward_calculation ><a href="#forward_calculation" class=header-anchor >Forward calculation</a></h1> <p>Here, synthetic calculation of travel-times is performed to practice handling SeaGap.</p> <p>You first prepare an underwater sound profile &#40;&quot;ss&#95;prof.zv&quot;: See <a href="/SeaGapDocs/dataformat/">Dataformat</a>&#41;.</p> <div class=important >&#36; head ss&#95;prof.zv</div> <pre><code class="plaintext hljs">0.00 1526.998
5.00 1529.598
10.00 1529.594
15.00 1529.637
20.00 1529.684
25.00 1529.748
30.00 1529.343
35.00 1528.586
40.00 1527.722
45.00 1525.194</code></pre> <p>SeaGap prepares the read function for &quot;ss&#95;prof.zv&quot; <code>read_prof&#40;fn,XDUCER_DEPTH&#41;</code>. <code>fn</code> is the file name &#40;such as <code>fn&#61;&quot;ss_prof.zv&quot;</code>&#41;. <code>XDUCER_DEPTH</code> is the depth of the sea-surface transponder from the sea-surface. Although <code>XDUCER_DEPTH</code> changes depending on attitudes of the sea-surface platform, it is enough to roughly provide its average value. This value is used for identifying which sound speed layer of &quot;ss&#95;prof.zv&quot; the transducer exists.</p> <pre><code class="julia hljs">XDUCER_DEPTH = <span class=hljs-number >3.0</span>
z, v, nz_st, numz = SeaGap.read_prof(<span class=hljs-string >&quot;ss_prof.zv&quot;</span>,XDUCER_DEPTH)</code></pre> <p>Performing the above &#40;<code>XDUCER_DEPTH</code> is set as 3.0&#41;, you obtain <code>z</code> &#40;depth value vector&#41;, <code>v</code> &#40;velocity value vector&#41;, <code>nz_st</code> &#40;number of layer that the transducer exists&#41;, and <code>numz</code> &#40;total number of layers&#41;. </p> <p>Next, you should obtain a local Earth radius. Using <code>localradius&#40;lat&#41;</code>, you can obtain a Gaussian mean radius and a local mean radius &#40;<a href="https://www.tandfonline.com/doi/abs/10.1080/01490419.2010.492283">Chadwell &amp; Sweeney, 2010</a>&#41;. They do not show significant difference for calculating a travel-time; therefore, SeaGap generally uses the Gaussian mean radius. </p> <p>For tha case <code>lat&#61;38.0</code>,</p> <pre><code class="julia hljs">Rg, Rl = SeaGap.localradius(<span class=hljs-number >38.0</span>)
(<span class=hljs-number >6.372923169901545e6</span>, <span class=hljs-number >6.372909276228537e6</span>)</code></pre> <p><code>Rg</code> is the Gaussian mean radius, and <code>Rl</code> is the local mean radius.</p> <p>Then, you can calculate one-way exact travel-times &#40;see <a href="/SeaGapDocs/methodtt/">Methodology</a>&#41; by <code>xyz2tt&#40;px,py,pz,xd,yd,zd,z,v,nz_st,numz,Rg,XDUCER_DEPTH&#41;</code> where <code>px</code>, <code>py</code>, and <code>pz</code> are position of a seafloor transponder, and <code>xd</code>, <code>yd</code>, and <code>zd</code> are position of a sea-surface transducer. Unit of these positions is meter.</p> <pre><code class="julia hljs">px = <span class=hljs-number >1500.0</span>; py = <span class=hljs-number >0.0</span>; pz = -<span class=hljs-number >3000.0</span>
xd = <span class=hljs-number >100.0</span>; yd = -<span class=hljs-number >100.0</span>; zd = -<span class=hljs-number >1.5</span> 
tc, Nint, vert = SeaGap.xyz2tt(px,py,pz,xd,yd,zd,z,v,nz_st,numz,Rg,XDUCER_DEPTH)
(<span class=hljs-number >2.220777604567047</span>, <span class=hljs-number >4</span>, <span class=hljs-number >0.9057269733438277</span>)</code></pre> <p><code>tc</code> is the one-way travel-time, <code>Nint</code> is the total number of iterations in the shooting method, and vert is the normalizing factor corresponding to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>M</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{M}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1901em;vertical-align:-0.345em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8451em;"><span style="top:-2.655em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> shown in <a href="/SeaGapDocs/methodkinematic/">Methodlogy</a>.</p> <p>If you&#39;d like to calculate the approximate travel-time &#40;see <a href="/SeaGapDocs/methodtt/">Methodology</a>&#41;, you have to run <code>ttcorrection&#40;px,py,pz,xducer_height,z,v,nz_st,numz,XDUCER_DEPTH,lat&#41;</code> in advance. Then, you can calculate the approximate travel-time by <code>xyz2tt_rapid&#40;&#41;</code></p> <pre><code class="julia hljs">xducer_height = -<span class=hljs-number >1.0</span>
Tv0, Vd, Vr, cc, rms = SeaGap.ttcorrection(px,py,pz,xducer_height,z,v,nz_st,numz,XDUCER_DEPTH,lat)</code></pre> <p>You have to provide <code>xducer_height</code> which is the mean height of the sea-surface transponder; if you have time-series of the sea-surface transponder height as <code>zd</code>, <code>xducer_height&#61;Statistics.mean&#40;zd&#41;</code>. But, note that rough value is acceptable for <code>xducer_height</code> within a few meters. </p> <p><code>Tv0</code>, <code>Vd</code>, <code>Vr</code>, and <code>cc</code> is correction paramters for performing <code>xyz2tt_rapid&#40;&#41;</code>.<code>rms</code> is RMS between the exact and the approximate travel-times when optimizing. </p> <p>Then, <code>xyz2tt_rapid&#40;&#41;</code> can be performed as following:</p> <pre><code class="julia hljs">tc_r, to_r, vert_r = SeaGap.xyz2tt_rapid(px,py,pz,xd,yd,zd,Rg,Tv0,Vd,Vr,xducer_height,cc)
(<span class=hljs-number >2.2207776042517358</span>, <span class=hljs-number >2.2207913746628574</span>, <span class=hljs-number >0.9057269733438277</span>)</code></pre> <p><code>tc_r</code> is the approximate travel-time,<code>to_r</code> is the simple spherical travel-time &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi mathvariant=normal >S</mi><mi mathvariant=normal >p</mi><mi mathvariant=normal >h</mi><mi mathvariant=normal >e</mi><mi mathvariant=normal >r</mi><mi mathvariant=normal >e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{\rm Sphere}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9694em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">Sphere</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>&#41;, and <code>vert_r</code> is the same with <code>vert</code>.</p> <p>Moreover, SeaGap equips another function to calculate the approximate travel-time: <code>xyz2ttg_rapid&#40;&#41;</code>.</p> <pre><code class="julia hljs">tc_g, vert_g, hh_x, hh_y = SeaGap.xyz2ttg_rapid(px,py,pz,xd,yd,zd,Rg,Tv0,Vd,Vr,xducer_height,cc)
(<span class=hljs-number >2.2207776042517358</span>, <span class=hljs-number >0.9057269733438277</span>, <span class=hljs-number >0.4669001167250292</span>, <span class=hljs-number >0.03335000833750208</span>)</code></pre> <p><code>tc_g</code> and <code>vert_g</code> are same with <code>tc_r</code> and <code>vert_r</code>, respectively. <code>hh_x</code> and <code>hh_y</code> are coefficients for expressing a deep gradient &#40;See <a href="/SeaGapDocs/methodmcmcpvg/">Methodology</a>&#41;.</p> <p>If you&#39;d like to obtain travel-times from various sea-surface points, you can do it like:</p> <pre><code class="julia hljs">xdv = <span class=hljs-built_in >Float64</span>[]; ydv = <span class=hljs-built_in >Float64</span>[]; zdv = <span class=hljs-built_in >Float64</span>[]; tcv = <span class=hljs-built_in >Float64</span>[]
  yd = <span class=hljs-number >0.</span>
  <span class=hljs-keyword >for</span> xd <span class=hljs-keyword >in</span> <span class=hljs-number >0</span>:<span class=hljs-number >100</span>:<span class=hljs-number >2000</span>
    <span class=hljs-comment ># --- Set z-value randomly from -5 to 0</span>
    zd = rand()*-<span class=hljs-number >5.0</span>
    <span class=hljs-comment ># --- Calculate TT</span>
    tc, Nint, vert = xyz2tt(px,py,pz,xd,yd,zd,z,v,nz_st,numz,Rg,XDUCER_DEPTH)
    push!(xdv,xd); push!(ydv,yd); push!(zdv,zd); push!(tcv,tc)
  <span class=hljs-keyword >end</span></code></pre> <p>Then, you can obtain as:</p> <pre><code class="julia hljs">hcat(xdv,ydv,zdv,tcv)
<span class=hljs-number >21</span>×<span class=hljs-number >4</span> <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Float64</span>}:
    <span class=hljs-number >0.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >0.961723</span>  <span class=hljs-number >2.24927</span>
  <span class=hljs-number >100.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >2.29837</span>   <span class=hljs-number >2.21929</span>
  <span class=hljs-number >200.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >1.91723</span>   <span class=hljs-number >2.19199</span>
  <span class=hljs-number >300.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >3.31861</span>   <span class=hljs-number >2.16533</span>
  <span class=hljs-number >400.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >2.87221</span>   <span class=hljs-number >2.14159</span>
  <span class=hljs-number >500.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >2.65163</span>   <span class=hljs-number >2.11956</span>
  <span class=hljs-number >600.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >4.79642</span>   <span class=hljs-number >2.09794</span>
  <span class=hljs-number >700.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >3.84929</span>   <span class=hljs-number >2.08025</span>
  <span class=hljs-number >800.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >0.492697</span>  <span class=hljs-number >2.06614</span>
  <span class=hljs-number >900.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >1.43069</span>   <span class=hljs-number >2.05133</span>
 <span class=hljs-number >1000.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >1.98022</span>   <span class=hljs-number >2.03887</span>
 <span class=hljs-number >1100.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >4.57954</span>   <span class=hljs-number >2.02721</span>
 <span class=hljs-number >1200.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >0.366569</span>  <span class=hljs-number >2.02222</span>
 <span class=hljs-number >1300.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >4.26667</span>   <span class=hljs-number >2.01407</span>
 <span class=hljs-number >1400.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >1.53643</span>   <span class=hljs-number >2.01252</span>
 <span class=hljs-number >1500.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >0.325024</span>  <span class=hljs-number >2.01221</span>
 <span class=hljs-number >1600.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >4.35567</span>   <span class=hljs-number >2.01065</span>
 <span class=hljs-number >1700.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >3.82967</span>   <span class=hljs-number >2.01435</span>
 <span class=hljs-number >1800.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >3.66194</span>   <span class=hljs-number >2.02004</span>
 <span class=hljs-number >1900.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >0.855999</span>  <span class=hljs-number >2.02966</span>
 <span class=hljs-number >2000.0</span>  <span class=hljs-number >0.0</span>  -<span class=hljs-number >1.55564</span>   <span class=hljs-number >2.03915</span></code></pre> <p>You can test the above calculation by <code>forward_test&#40;lat,XDUCER_DEPTH,pos,fn&#61;&quot;ss_prof.zv&quot;&#41;</code> with <code>pos</code> is a position vector of a seafloor trannsponder <code>pos &#61; &#91;px,py,pz&#93;</code>.</p> <pre><code class="julia hljs">xdv, ydv, zdv, tcv = SeaGap.foward_test(lat,XDUCER_DEPTH,[px,py,pz],fn=<span class=hljs-string >&quot;ss_prof.zv&quot;</span>)</code></pre>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Fumiaki Tomita. Last modified: January 24, 2023.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
  </main> 
  <script src="/SeaGapDocs/libs/vela/metisMenu.min.js"></script>
  <script src="/SeaGapDocs/libs/vela/slideout.min.js"></script>
  
    



  
  
    <script src="/SeaGapDocs/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>
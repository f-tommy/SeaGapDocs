<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/SeaGapDocs/libs/highlight/styles/github.min.css"> <link href="/SeaGapDocs/css/franklin.css" rel=stylesheet > <link href="/SeaGapDocs/css/vela.css" rel=stylesheet > <script src="/SeaGapDocs/libs/vela/jquery.min.js"></script> <link rel=icon  href="/SeaGapDocs/assets/favicon.png"> <title>SeaGapDocs</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>SeaGap Docs</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/SeaGapDocs/index.html">Home</a> <li><a href="/SeaGapDocs/install/">Installation</a> <li><a href="/SeaGapDocs/dataformat/">Dataformat</a> <li><a href="" class=has-arrow >Methodology</a> <ul> <li><a href="/SeaGapDocs/methodoverview/">Overview</a> </ul> <ul> <li><a href="/SeaGapDocs/methodtt/">Travel-time calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/methodkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodsingle/">Individual transponder positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodmcmcpvg/">Static array positioning with gradients</a> </ul> <li><a href="" class=has-arrow >Tutorials</a> <ul> <li><a href="/SeaGapDocs/tutorialforward/">Forward calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialdenoise/">Outlier removal</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialmcmcpvg/">MCMC static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialts/">Line fitting for time-series</a> </ul> <li><a href="/SeaGapDocs/others/">Others</a> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Tutorials</h1> <hr> <div class=franklin-content > <h1 id=kinematic_array_positioning ><a href="#kinematic_array_positioning" class=header-anchor >Kinematic array positioning</a></h1> <p>In SeaGap, the kinematic positioning function &#40;<code>kinematic_array</code>&#41; based on <a href="https://earth-planets-space.springeropen.com/articles/10.1186/BF03351996">Kido et al. &#40;2006&#41;</a> and <a href="https://earth-planets-space.springeropen.com/articles/10.1186/BF03352785">Kido et al. &#40;2008&#41;</a> is provided. A kinematic array position can be estimated for each shot group by Gauss-Newton method.</p> <div class=franklin-toc ><ol><li><a href="#input_data">Input data</a><li><a href="#estimation">Estimation</a><li><a href="#visualization">Visualization </a><li><a href="#outlier_elimination">Outlier elimination</a></ol></div> <h2 id=input_data ><a href="#input_data" class=header-anchor >Input data</a></h2> <p>To perform <code>kinematic_array</code>, you have to prepare four input files denoted in <a href="/SeaGapDocs/dataformat/">Dataformat</a>: &quot;tr-ant.inp&quot;. &quot;pxp-ini.inp&quot;, &quot;ss&#95;prof.inp&quot;, and &quot;obsdata.inp&quot;. Outliers in &quot;obsdata.inp&quot; should be removed in advance; SeaGap includes a simple <a href="/SeaGapDocs/tutorialdenoise/">outlier removal</a> function.</p> <p>In &quot;obsdata.inp&quot;, you have to write the shot group number.</p> <div class=important >&#36; head obsdata.inp</div> <pre><code class=language-plaintext >4 4.092871 500664407.000000 107.049217 74.549984 27.432900 -44.27880 -0.45120 0.53640 500664413.190022 110.954811 76.324655 28.280988 -44.93029 -2.03165 0.89020 1
4 4.090700 500664437.000000 124.727831 83.456801 27.671150 -49.09920 -0.61400 1.18480 500664443.187852 127.737889 85.946412 27.083811 -50.11868 -0.25212 -1.54370 2
1 3.932951 500664917.000000 328.921220 253.692382 28.154000 -52.76000 -1.08760 -4.84800 500664923.030102 332.591693 256.317961 27.675444 -52.68875 -0.89626 1.21533 3
3 4.357953 500664917.000000 328.921220 253.692382 28.154000 -52.76000 -1.08760 -4.84800 500664923.455105 332.632065 256.226557 28.147424 -52.71458 -1.45692 -0.33433 3
4 4.113388 500664917.000000 328.921220 253.692382 28.154000 -52.76000 -1.08760 -4.84800 500664923.210540 332.609684 256.278857 27.880494 -52.70038 -1.13751 0.54746 3
1 3.915718 500664977.000000 373.032034 269.762113 26.501800 -67.98040 0.74000 1.68840 500664983.012870 378.674213 271.833273 27.468078 -71.14971 -1.07657 -0.09575 4
3 4.385641 500664977.000000 373.032034 269.762113 26.501800 -67.98040 0.74000 1.68840 500664983.482792 379.052958 272.008269 27.946919 -71.32463 -1.99330 0.01337 4
4 4.107478 500664977.000000 373.032034 269.762113 26.501800 -67.98040 0.74000 1.68840 500664983.204630 378.825441 271.905307 27.676287 -71.21717 -1.48302 -0.05251 4
1 3.891855 500665037.000000 433.053071 301.791614 27.998850 -102.24360 -2.02200 -0.07680 500665042.989008 438.909005 305.956022 27.407876 -104.12427 -1.15657 0.14795 5
3 4.431185 500665037.000000 433.053071 301.791614 27.998850 -102.24360 -2.02200 -0.07680 500665043.528337 439.555522 306.315721 27.308195 -104.49262 -0.77367 -0.75093 5</code></pre> <p>The last column shows the shot group number. <code>kinematic_array&#40;&#41;</code> estimates a horizontal array position using the data with each shot number if number of the observational data lines are more than <code>NR</code> &#40;<code>NR&#61;3</code> by default, but you cannot assign <code>NR</code>&lt;2 because number of unknown paramters is 3&#41;. The detailed format of &quot;obsdata.inp&quot; are shown in <a href="/SeaGapDocs/dataformat/">Dataformat</a>.</p> <h2 id=estimation ><a href="#estimation" class=header-anchor >Estimation</a></h2> <p>You can simply perform <code>kinematic_array</code> as following: </p> <pre><code class=language-julia >lat&#61;36.15753; TR_DEPTH&#61;4.0
SeaGap.kinematic_array&#40;lat,TR_DEPTH&#41;</code></pre> <p>The input files are <code>fn1</code>, <code>fn2</code>, <code>fn3</code>, and <code>fn4</code>; they correspond to &quot;tr-ant.inp&quot;. &quot;pxp-ini.inp&quot;, &quot;ss&#95;prof.inp&quot;, and &quot;obsdata.inp&quot; by default.</p> <p>Then, after performing, you obtained a log file as <code>fno0</code> &#40;<code>fno0&#61;&quot;log.txt&quot;</code> by default&#41;, a position file <code>fno1</code> &#40;<code>fno1&#61;&quot;kinematic_array.out&quot;</code> by default&#41;, and a data misfit file <code>fno2</code> &#40;<code>fno2&#61;&quot;residual_kinematic.out&quot;</code>&#41;.</p> <p>&quot;kinematic&#95;array.out&quot;</p> <ul> <li><p>1: the transmitting time &#91;sec&#93;</p> <li><p>2: number of the used observational data for each shot group</p> <li><p>3: Easting displacement &#91;m&#93;</p> <li><p>4: Northing displacement &#91;m&#93;</p> <li><p>5: NTD &#91;sec&#93;</p> <li><p>6: Std. of Easting disp. &#91;m&#93;</p> <li><p>7: Std. of Northing disp. &#91;m&#93;</p> <li><p>8: Std. of NTD &#91;sec&#93;</p> <li><p>9: the shot group number</p> </ul> <p>Note that 6-8 columns show &quot;Inf&quot; if number of the used observational data is 3.</p> <div class=important >&#36; head kinematic&#95;array.out</div> <pre><code class=language-plaintext >5.00664917e8 3 0.1566285383701925 -0.08084103851557366 0.001964992050726316 Inf Inf Inf 3
5.00664977e8 3 0.13939911809947528 -0.04499895207107005 0.0019757436803323003 Inf Inf Inf 4
5.00665037e8 3 0.09543831406774547 -0.04341029104817091 0.001959985388952123 Inf Inf Inf 5
5.00665097e8 3 0.045798927100811807 0.0066282565936057174 0.0019531590791335646 Inf Inf Inf 6
5.00665157e8 4 0.06507794423107215 0.042050855826987345 0.002017272903396969 0.000837388479584557 0.0008081416559444339 3.3755905697959157e-7 7
5.00665217e8 4 0.06489636929261414 0.07112273083172106 0.0019966150972007893 0.03090010981627865 0.02987198780910828 1.2991019749087965e-5 8
5.00665277e8 4 0.11414759308433275 0.0927578359217722 0.0019866554933129273 0.0670404792349682 0.06036580065982195 2.776140933797056e-5 9
5.00665337e8 3 -0.028065834557040262 0.1526677050654155 0.0019312018209541202 Inf Inf Inf 10
5.00665397e8 4 0.06384100583318393 0.08448717850690535 0.0019825084648921504 0.05124710438364338 0.04479490342620803 2.2689228300406885e-5 11
5.00665457e8 4 0.1213202890494057 0.06817851224344924 0.0019750296070910906 0.04655675804023427 0.038432842546245086 2.060611297346868e-5 12</code></pre> <p>&quot;residual&#95;kinematic.out&quot;</p> <ul> <li><p>1: the transmitted time</p> <li><p>2: the transponder number</p> <li><p>3: misfit &#91;sec&#93;</p> <li><p>4: number of interations</p> <li><p>5: the shot group number</p> <li><p>6: number of the used data</p> </ul> <p>If the number of the used data is 3, the misfits are almost zero.</p> <div class=important >&#36; head -n 16 residual&#95;kinematic.out</div> <pre><code class=language-plaintext >5.00664917e8 1 -1.734723475976807e-18 3 3 3
5.00664917e8 3 4.336808689942018e-18 3 3 3
5.00664917e8 4 -3.903127820947816e-18 3 3 3
5.00664977e8 1 -8.673617379884035e-19 3 4 3
5.00664977e8 3 6.071532165918825e-18 3 4 3
5.00664977e8 4 -4.336808689942018e-18 3 4 3
5.00665037e8 1 4.0332320816460765e-17 3 5 3
5.00665037e8 3 -1.1839487723541708e-16 3 5 3
5.00665037e8 4 1.214306433183765e-17 3 5 3
5.00665097e8 1 -2.6020852139652106e-18 3 6 3
5.00665097e8 3 3.903127820947816e-18 3 6 3
5.00665097e8 4 2.6020852139652106e-18 3 6 3
5.00665157e8 1 1.9521010603167424e-7 3 7 4
5.00665157e8 2 -2.49146658609211e-7 3 7 4
5.00665157e8 3 2.9776429482687716e-7 3 7 4
5.00665157e8 4 -2.4382774225020776e-7 3 7 4</code></pre> <p>You can change the following inversion criterion values by keyword arguments:</p> <ul> <li><p><code>eps</code>: Convergence criteria &#91;m&#93;, the default is 1.e-4 &#40;each inversion is converged when RMS of difference between the previous and the new solutions of the horizontal array displacements &lt; <code>eps</code>&#41;</p> <li><p><code>ITMAX</code>: Maximum number of interations, the default is 20</p> <li><p><code>delta_pos</code>: Infinitesimal amount of the array positions to calculate the Jacobian matrix, the default is 1.e-4 &#91;m&#93;</p> </ul> <p>For example:</p> <pre><code class=language-julia >SeaGap.kinematic_array&#40;lat,TR_DEPTH,delta_pos&#61;1.e-5&#41;</code></pre>
<p>If you&#39;d like to calculate an average position during a campaign  from the positioning results &quot;kinematic&#95;array.out&quot;, you can use <code>position_kinematic&#40;;fn,weight,fno&#41;</code>. <code>fn</code> is the input file name &#40;<code>fn&#61;&quot;kinematic_array.out&quot;</code> by default&#41;, and <code>fno</code> is the outpt file name <code>fno&#61;&quot;position_kinematic.out&quot;</code>. If <code>weight&#61;true</code>, weighted mean position is calculated using the shot groups with number of shot data for each group &gt;&#61; 4 &#40;<code>weight&#61;false</code> by default&#41;; thus, you cannot set <code>weight&#61;true</code> for a GNSS-A site with only three transponders.</p>
<p>For example:</p>
<pre><code class=language-julia >SeaGap.position_kinematic&#40;fn&#61;&quot;kinematic_array.out&quot;,weight&#61;false&#41;</code></pre>
<p>&quot;position&#95;kinematic.out&quot;</p>
<ul>
<li><p>1: the mean time &#91;sec&#93;</p>

<li><p>2: EW mean array displacement &#91;m&#93; </p>

<li><p>3: NS mean array displacement &#91;m&#93; </p>

<li><p>4: UD mean array displacement &#91;m&#93; <strong>Not available</strong></p>

<li><p>5: Std of EW array displacement &#91;m&#93; </p>

<li><p>6: Std of NS array displacement &#91;m&#93; </p>

<li><p>7: Std of UD array displacement &#91;m&#93; <strong>Not available</strong></p>

</ul>
<div class=important >&#36; cat position&#95;kinematic.out</div>
<pre><code class=language-plaintext >5.006910713024619e8 0.02405891197862978 -0.00999109884151074 NA 0.04738812642214625 0.0592217059058522 NA</code></pre>
<h2 id=visualization ><a href="#visualization" class=header-anchor >Visualization </a></h2>
<p>If you&#39;d like to plot the array positions in a horizontal map, you can use <code>plot_map_array_kinematic&#40;xrange,yrange; autoscale,fn,fno,show,col_num&#41;</code> function.</p>
<ul>
<li><p>If <code>autoscale&#61;true</code> &#40;default&#41;, the plot range is automatically determined. If <code>autoscale&#61;false</code>, the plot range is fixed by <code>xrange</code> and <code>yrange</code>.</p>

<li><p><code>fn</code> is the input file name: &quot;array&#95;kinematic.out&quot; by default.</p>

<li><p>If <code>show&#61;false</code>, the figure is saved as <code>fno</code> &#40;<code>fno</code> is name of the output figure&#41;. If <code>show&#61;true</code> in REPL, a figure is temporally shown.</p>

<li><p>If <code>col_num&#61;1</code> &#40;default&#41;, the plot is colored by the observation time. If <code>col_num&#61;2</code>, the plot is colored by number of the used observational data. If <code>col_num&#61;0</code>, the plot is colored by blue. </p>

</ul>
<pre><code class=language-julia >SeaGap.plot_map_kinematic_array&#40;&#40;-0.5,0.5&#41;,&#40;-0.5,0.5&#41;,autoscale&#61;false,fno&#61;&quot;map_array_kinematic.png&quot;&#41;</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/map_array_each.png" width=300  height=300 >
    <div style="clear: both"></div>      
  </div>
</div>

<p>If you&#39;d like to plot the array positions in time-series, you can use <code>plot_time_kinematic_array&#40;EW_range,NS_range.ntdrange.autoscale,fn,fno,show&#41;</code> function.</p>
<ul>
<li><p>If <code>autoscale&#61;true</code> &#40;default&#41;, the plot range is automatically determined. If <code>autoscale&#61;false</code>, the plot range of y-componet is fixed by <code>EW_range</code>, <code>NS_range</code>, and <code>ntdrange</code>. The range of x-compoent &#40;Time&#41; is automatically determined in the both cases.</p>

<li><p><code>fn</code> is the input file name: &quot;kinematic&#95;array.out&quot; by default.</p>

<li><p>If <code>show&#61;false</code>, the figure is saved as <code>fno</code> &#40;<code>fno</code> is name of the output figure&#41;. If <code>show&#61;true</code> in REPL, a figure is temporally shown.</p>

</ul>
<pre><code class=language-julia >SeaGap.plot_time_kinematic_array&#40;fno&#61;&quot;time_kinematic_array.pdf&quot;&#41;</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/time_array_each.png" width=450  height=450 >
    <div style="clear: both"></div>      
  </div>
</div>

<h2 id=outlier_elimination ><a href="#outlier_elimination" class=header-anchor >Outlier elimination</a></h2>
<p>If you&#39;ld like to eliminate outlier from the positioning results &quot;kinematic&#95;array.out&quot;, SeaGap provides <code>denoise_kinematic&#40;;method,n,sigma1,sigma2,type,save,prompt,fn,fn0,fno&#41;</code> as similar with <code>denoise&#40;&#41;</code> in <a href="/SeaGapDocs/tutorialdenoise/">Outlier removal</a>. <code>denoise_kinematic&#40;&#41;</code> peform two types of filters; one is a spatial filter, and the other is a temporal filter.</p>
<p>In the spatial filter, we first calculate a mean/median position of the horizontal array positions, and then calculate standard deviation. The horiontal array positions beyond the range of <code>sigma1</code>&#42;&#40;Std&#41; are eliminated as outliers.</p>
<p>In the temporal filter, we first perform a running mean/median filter to time-series of the horizontal array positions; then, calcualte standard deviation of the residuals after removing the filtered array positions. The residuals after removing the filtered array positions beyond the range of <code>sigma2</code>&#42;&#40;Std&#41; are eliminated as outliers.</p>
<p>If you&#39;d like to perform both filters, you set <code>type&#61;&quot;both&quot;</code>. You can set <code>type&#61;spatial</code> or <code>type&#61;temporal</code> if you&#39;d like to perform only one of the filters. <code>method</code> selects &quot;mean&quot; or &quot;median&quot;.</p>
<p>Other arguments are used as following:</p>
<ul>
<li><p><code>fn</code>: Input file name</p>

<li><p><code>fno1</code>: Output figure name &#40;<code>fno1&#61;&quot;denoise_kinematic.pdf&quot;</code> by default&#41;</p>

<li><p><code>fno2</code>: Output file which lists the eliminated shot numbers</p>

<li><p><code>n</code>: Window size for the running filter</p>

<li><p><code>save</code>: if <code>save&#61;true</code>, the input data file <code>fn</code> is renamed and rewritten in <code>fn0</code> &#40;<code>save&#61;true</code> by default&#41;</p>

<li><p><code>prompt</code>: if <code>prompt&#61;true</code>, confirmation message is shown; if false, the input file is forcely rewritten &#40;<code>prompt&#61;true</code> by default&#41;  </p>

</ul>
<p>You can adjust a figure shown by this function can be adjusted by the other additional arguments.</p>
<p>If you perform <code>denoise_kinematic</code> as following:</p>
<pre><code class=language-julia >SeaGap.denoise_kinematic&#40;n&#61;7,sigma1&#61;4.0,sigma2&#61;5.0,method&#61;&quot;median&quot;&#41;</code></pre>
<p>the following figure is shown.</p>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/denoise_each.png" width=350  height=350 >
    <div style="clear: both"></div>
  </div>
</div>

<p>Then, the following message is shown if <code>prompt&#61;true</code>:</p>
<pre><code class=language-plaintxt >Do you accept the denoise processin?</code></pre>
<p>If you accept the elimination, you enter &quot;yes&quot;; then, the outliers &#40;red symbols&#41; are eliminated from &quot;kinematic&#95;array.out&quot; and the outlier list <code>fno2</code> is saved:</p>
<div class=important >&#36; cat eliminated&#95;list.out</div>
<pre><code class=language-plaintext >59
61
62
63
64
71
26
86
87
104
57
77
79</code></pre>
<p>These correspond to the 9th colmun of &quot;kinematic&#95;array.out&quot;.</p>
<p>If you enter &quot;no&quot;, &quot;kinematic&#95;array.out&quot; is not updated.</p>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Fumiaki Tomita. Last modified: February 17, 2023.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
  </main> 
  <script src="/SeaGapDocs/libs/vela/metisMenu.min.js"></script>
  <script src="/SeaGapDocs/libs/vela/slideout.min.js"></script>
  
  
    <script src="/SeaGapDocs/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>
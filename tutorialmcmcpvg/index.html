<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/SeaGapDocs/libs/highlight/styles/github.min.css"> <link href="/SeaGapDocs/css/franklin.css" rel=stylesheet > <link href="/SeaGapDocs/css/vela.css" rel=stylesheet > <script src="/SeaGapDocs/libs/vela/jquery.min.js"></script> <link rel=icon  href="/SeaGapDocs/assets/favicon.png"> <title>SeaGapDocs</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>SeaGap Docs</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/SeaGapDocs/index.html">Home</a> <li><a href="/SeaGapDocs/install/">Installation</a> <li><a href="/SeaGapDocs/dataformat/">Dataformat</a> <li><a href="" class=has-arrow >Methodology</a> <ul> <li><a href="/SeaGapDocs/methodoverview/">Overview</a> </ul> <ul> <li><a href="/SeaGapDocs/methodtt/">Travel-time calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/methodkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodsingle/">Individual transponder positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/methodmcmcpvg/">Static array positioning with gradients</a> </ul> <li><a href="" class=has-arrow >Tutorials</a> <ul> <li><a href="/SeaGapDocs/tutorialforward/">Forward calculation</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialdenoise/">Outlier removal</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialkinematic/">Kinematic array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialstatic/">Static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialmcmcpvg/">MCMC static array positioning</a> </ul> <ul> <li><a href="/SeaGapDocs/tutorialts/">Line fitting for time-series</a> </ul> <li><a href="/SeaGapDocs/others/">Others</a> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Tutorials</h1> <hr> <div class=franklin-content > <h1 id=mcmc_static_array_positioning ><a href="#mcmc_static_array_positioning" class=header-anchor >MCMC static array positioning</a></h1> <div class=franklin-toc ><ol><li><a href="#make_initial_value_file">Make initial value file</a><li><a href="#make_initial_value_file_generated_from_the_least_square_method">Make initial value file generated from the least square method</a><li><a href="#run_mcmc_processing">Run MCMC processing</a><li><a href="#output_text_files">Output text files</a><li><a href="#visualization">Visualization</a><ol><li><a href="#posterior_pdf_and_rms_variation_through_the_mcmc_iteration">Posterior PDF and RMS variation through the MCMC iteration</a><li><a href="#parameter_variation_through_the_mcmc_iteration">Parameter variation through the MCMC iteration</a><li><a href="#correlation_among_the_unknown_parameters">Correlation among the unknown parameters</a><li><a href="#histogram_for_each_unknown_parameter">Histogram for each unknown parameter</a><li><a href="#histograms_and_heatmaps_for_multiple_parameters">Histograms and heatmaps for multiple parameters </a><li><a href="#spatial_variation_of_travel-time_residuals_shallow_gardient">Spatial variation of travel-time residuals &#40;shallow gardient&#41;</a><li><a href="#temporal_variation_of_the_travel-time_residuals">Temporal variation of the travel-time residuals</a></ol></ol></div> <p>The static array positioning methods considering a sound speed gradient through a MCMC technique in <a href="https://earth-planets-space.springeropen.com/articles/10.1186/s40623-022-01740-0">Tomita &amp; Kido, 2022</a> was implemented as <code>static_array_mcmcgrad.jl</code>, and its slightly updated version was also implemented as <a href="https://earth-planets-space.springeropen.com/articles/10.1186/s40623-024-01987-9">Tomita &amp; Kido, 2024</a>. However, these methods are outdated from SeaGap v1.1.0. The highly improved MCMC method &#40;under review&#41; is implemented as <code>static_array_mcmcgradv&#40;&#41;</code>. The SeaGap developer strongly recommend to use <code>static_array_mcmcgradv.jl</code>. </p> <h2 id=make_initial_value_file ><a href="#make_initial_value_file" class=header-anchor >Make initial value file</a></h2> <p>Firstly, we have to prepare an initial value file &#40;named &quot;initial.inp&quot; by default&#41; which lists initial values of the unknown parameters for performing <code>static_array_mcmcgradv&#40;&#41;</code>. </p> <p>The dataformat of &quot;initial.inp&quot; is &#40;Columns 1: Initial value, 2: Step width, 3: Parameter name&#41;. The step width is used as perturbation &#40;Metropolis method&#41; when new parameter candidates are produced during the MCMC chain. This should be appropriately given to effectively perform a MCMC sampling.</p> <p>The type of unknown parameters to be placed on each line of this file is fixed and cannot be changed.</p> <ul> <li><p>Lines 1-3: Array displacements for EW, NS, UD &#91;m&#93;</p> <li><p>Lines 4-5: Shallow gradients for EW, NS &#91;sec/km&#93;</p> <li><p>Lines 6-7: Gradient depths for EW, NS &#91;km&#93;</p> <li><p>Line 8: Scaling factor for the observational error</p> <li><p>Line 9: Scaling factor for temporal S-NTD roughness</p> <li><p>Line 10: Scaling factor for temporal shallow gradient roughness</p> <li><p>Line 11: Scaling factor for temporal gradient depth roughness</p> <li><p>Lines 7-11: Long-term NTD modeled by 4th polynomial function &#40;degree: 0-4&#41;</p> <li><p>Lines 12-&#40;12&#43;NPB1&#41;: Coefficients for the 3d B-spline bases of L-NTD</p> <li><p>Lines &#40;13&#43;NPB1&#41;-: Coefficients for the 3d B-spline bases of S-NTD</p> </ul> <p>This file can be produced by <code>make_initial_gradv&#40;NPB1, NPB2; fn, fno&#41;</code> function using the results of static array positioning method <code>static_array_s&#40;&#41;</code>. In <code>static_array_mcmcgradv&#40;&#41;</code>, NTD is decomposed into L-NTD and S-NTD. They are expressed by the 3d B-spline functions, and their total numbers of spline bases are NPB1 and NPB2, respectively. Tomita &#40;under review&#41; fixed NPB1 as 5 and NPB2 as the number determined by BIC in <code>static_array&#40;&#41;</code> and <code>static_array_AICBIC&#40;&#41;</code>.</p> <h2 id=make_initial_value_file_generated_from_the_least_square_method ><a href="#make_initial_value_file_generated_from_the_least_square_method" class=header-anchor >Make initial value file generated from the least square method</a></h2> <p><code>static_array_s&#40;&#41;</code> estimates a static array position, L-NTD, S-NTD, and the shallow gradients &#40;temporally-fixed&#41; by Gauss-Newton method. This method is introduced in Tomita &#40;under review&#41;. To solve these parameters, we need to constrain L2-norm of S-NTD using a hyper-parameter alpha.</p> <pre><code class="julia hljs">lat=<span class=hljs-number >36.15753</span>; TR_DEPTH=[<span class=hljs-number >4.0</span>]; NPB1=<span class=hljs-number >5</span>; NPB2=<span class=hljs-number >73</span>; alpha = <span class=hljs-number >0.0</span>
SeaGap.static_array_s(lat,TR_DEPTH,alpha,NPB1,NPB2,fno1=<span class=hljs-string >&quot;solve.out&quot;</span>)
SeaGap.plot_ntd_s(fno=<span class=hljs-string >&quot;ntd_s.png&quot;</span>)</code></pre> <p>You can check the travel time residuals in this modelling by <code>plot_ntd_s&#40;&#41;</code>.</p> <div class=row > <div class=container > <img src="/SeaGapDocs/assets/ntd_s.png" width=350  height=350 > <div style="clear: both"></div> </div> </div> <p><code>fno1</code> includeis the estimates, and this file is used for making the initial value. <code>alpha</code> is typically zero, but the optimal value of <code>alpha</code> can be evaluated by ABIC. The optimization using the ABIC value is performed by <code>static_array_s_ABIC&#40;&#41;</code> </p> <pre><code class="julia hljs">r1=-<span class=hljs-number >3.0</span>; r2=<span class=hljs-number >3.0</span>; r3=<span class=hljs-number >0.5</span>
SeaGap.static_array_s_ABIC(r1,r2,r3,lat,TR_DEPTH,NPB1,NPB2)
SeaGap.plot_ABIC(show=<span class=hljs-literal >true</span>)</code></pre> <p><code>r1</code>, <code>r2</code>, and <code>r3</code> are lower limit, upper limit, and interval of the hyper-parameter range, respectively. </p> <div class=row > <div class=container > <img src="/SeaGapDocs/assets/ABIC_search.png" width=350  height=350 > <div style="clear: both"></div> </div> </div> <p>Using <code>solve.out</code> obtained from <code>static_array_s&#40;&#41;</code>, you can obtain the initial value file for MCMC. </p> <pre><code class="julia hljs">SeaGap.make_initial_gradv(NPB1,NPB2)</code></pre>
<div class=important >&#36; head -n 20 initial.inp</div>
<pre><code class="plaintext hljs">0.025410462308784486 0.0003285916454800491 EW_disp.
-0.01569704833998688 0.00032709528235116216 NS_disp.
-0.03417871494024675 0.00119971349382272 UD_disp.
-8.37248428698407e-5 2.0e-6 S-Grad_EW
8.89971826238189e-5 2.0e-6 S-Grad_NS
0.0 0.01 G-Depth_EW
0.0 0.01 G-Depth_NS
-4.0 0.005 HP_error
-4.5 0.005 HP_S-NTD
-4.5 0.005 HP_S-Grad
-1.0 0.005 HP_G-Depth
0.001885751243719274 2.0e-6 L-NTD_1
0.0019299017374440242 2.0e-6 L-NTD_2
0.0017720436581544553 2.0e-6 L-NTD_3
0.0024791239571273424 2.0e-6 L-NTD_4
0.005824457411845061 2.0e-6 L-NTD_5
0.0 2.0e-6 S-NTD_1
0.0 2.0e-6 S-NTD_2
0.0 2.0e-6 S-NTD_3
0.0 2.0e-6 S-NTD_4</code></pre>
<h2 id=run_mcmc_processing ><a href="#run_mcmc_processing" class=header-anchor >Run MCMC processing</a></h2>
<p>Before you run <code>static_array_mcmcgradv&#40;&#41;</code>, you have to set number of threads for the thread parallelization in your terminal as:</p>
<div class=important >&#36; export JULIA&#95;NUM&#95;THREADS&#61;4</div>
<p>or you have to run Julia as:</p>
<div class=important >&#36; julia -t 4</div>
<p>This value is determined depending on your machine ability.</p>
<p>Then, after setting the above thread number and preparing the above input files, you can perform <code>static_array_mcmcgrad&#40;lat,TR_DEPTH,NPB; NSB,nloop,nburn,ndelay,NA,lscale,daave,daind,tscale,fn1,fn2,fn3,fn4,fn5,fno0,fno1,fno2,fno3,fno4,fno5,fno6,fno7&#41;</code> function as following:</p>
<pre><code class="julia hljs">lat=<span class=hljs-number >36.15753</span>; TR_DEPTH=[<span class=hljs-number >4.0</span>]; NPB1=<span class=hljs-number >5</span>; NPB2=<span class=hljs-number >73</span>; NPB=<span class=hljs-number >3</span>; NPB4=<span class=hljs-number >5</span>; dep=<span class=hljs-number >2.7</span>
SeaGap.static_array_mcmcgradv(lat,dep,TR_DEPTH,NPB1,NPB2,NPB3,NPB4)</code></pre>
<p>Meanings of the arguments of <code>static_array_mcmcgrad&#40;&#41;</code> are following:</p>
<ul>
<li><p><code>lat</code>: Latitude of the site</p>

<li><p><code>dep</code>: Water depth of the site &#91;km&#93;</p>

<li><p><code>TR_DEPTH</code>: Depth of the sea-surface transducer from the sea-surface &#91;m&#93;</p>

<li><p><code>NPB1</code>: Number of the 3d B-spline bases for L-NTD</p>

<li><p><code>NPB2</code>: Number of the 3d B-spline bases for S-NTD</p>

<li><p><code>NPB3</code>: Number of the 3d B-spline bases for the shallow gradient</p>

<li><p><code>NPB4</code>: Number of the 3d B-spline bases for the gradient depth</p>

</ul>
<p>How to setup the prior distributions constraining the sound speed parameters will be shown after the corresponding paper &#40;Tomita, under review&#41; is published.</p>
<h2 id=output_text_files ><a href="#output_text_files" class=header-anchor >Output text files</a></h2>
<div class=importantv >fno0: the log file, which shows the analytical conditions, and so on</div>
<div class=important >&#36; head log.txt</div>
<pre><code class="plaintext hljs">2024-06-12T19:00:23.862
static_array_mcmcgradv.jl at /Users/test/data/mcmc
Number of threads: 6
Number_of_B-spline_knots_L-NTD: 5
Number_of_B-spline_knots_S-NTD: 73
Number_of_B-spline_knots_S-Grad: 5
Number_of_B-spline_knots_G-Depth: 5
Default_latitude: 36.15753
Site_depth: 2.7</code></pre>
<div class=importantv >fno1: The sampled unknown parameters &#40;&quot;sample.out&quot; by default&#41;</div>
<p>In this file, the unknown parameter names written in &quot;initial.inp&quot; is written at the first line. Then, the sampled parameters for each MCMC iteration at each line.</p>
<div class=important >&#36; head sample.out | awk &#39;&#123;print &#36;1,&#36;2,&#36;3,&#36;4,&#36;5,&#36;6, &#36;7&#125;&#39;</div>
<pre><code class="plaintext hljs">EW_disp. NS_disp. UD_disp. S-Grad_EW S-Grad_NS G-Depth_EW G-Depth_NS
0.0602 -0.0488 -0.0228 -8.4117e-05 1.0476e-04 1.0350 1.0995
0.0601 -0.0490 -0.0221 -8.2685e-05 1.0395e-04 1.0395 1.0991
0.0605 -0.0487 -0.0213 -8.0250e-05 1.0588e-04 1.0350 1.0908
0.0604 -0.0488 -0.0206 -8.2319e-05 1.0486e-04 1.0408 1.0865
0.0605 -0.0490 -0.0204 -8.1920e-05 1.0587e-04 1.0282 1.0876
0.0609 -0.0490 -0.0214 -8.2339e-05 1.0663e-04 1.0223 1.0867
0.0607 -0.0487 -0.0226 -8.2473e-05 1.0556e-04 1.0192 1.0818
0.0606 -0.0486 -0.0229 -8.4043e-05 1.0620e-04 1.0163 1.0856
0.0606 -0.0483 -0.0230 -8.5462e-05 1.0738e-04 1.0175 1.0964</code></pre>
<div class=importantv >fno2: The PDFs and RMS &#40;&quot;mcmc.out&quot; by default&#41;</div>
<p>In this file, the PDF and RMS values for each MCMC iteration are recorded.</p>
<ul>
<li><p>1: Iteration number</p>

<li><p>2: Acceptance &#40;0 and 1 are reject and accept the MCMC perturbation, respectively&#41;</p>

<li><p>3: The posterior density</p>

<li><p>4: RMS</p>

</ul>
<div class=important >&#36; head mcmc.out</div>
<pre><code class="plaintext hljs">5 0 30584.690737 7.928724e-05
10 1 30589.557237 7.948412e-05
15 0 30609.415959 7.921514e-05
20 1 30654.078665 7.846873e-05
25 0 30662.815274 7.879291e-05
30 0 30670.206108 7.807382e-05
35 0 30670.206108 7.815714e-05
40 1 30690.376887 7.799422e-05
45 1 30698.578345 7.794760e-05
50 0 30703.897776 7.760564e-05</code></pre>
<div class=importantv >fno3: The position file &#40;&quot;position.out&quot; by default&#41;</div>
<p>This is same format with the &quot;position.out&quot; of <code>pos_array_all&#40;&#41;</code>. &#40;1: the cumlative seconds of the observational time, 2-4: Mean array displacements for EW, NS, UD componets, 5-7: Standard deviations of 2-4&#41;</p>
<div class=important >&#36; cat position.out</div>
<pre><code class="plaintext hljs">500691154.42 0.059391 -0.047448 -0.031077 0.004650 0.006644 0.005929</code></pre>
<div class=importantv >fno4: Statistical values for each unknown parameter &#40;&quot;statistics.out&quot; by default&#41;</div>
<div class=important >&#36; head statistics.out</div>
<pre><code class="plaintext hljs">#Parameter mean std median min max
&quot;EW_disp.&quot;   0.059391 0.004650  0.058865  0.046047  0.073455
&quot;NS_disp.&quot;  -0.047448 0.006644 -0.046633 -0.070896 -0.029924
&quot;UD_disp.&quot;  -0.031077 0.005929 -0.031296 -0.050463 -0.014910
&quot;S-Grad_EW&quot; -0.000061 0.000014 -0.000060 -0.000103 -0.000023
&quot;S-Grad_NS&quot;  0.000137 0.000012  0.000137  0.000094  0.000174
&quot;G-Depth_EW&quot; 0.953730 0.091683  0.954043  0.643468  1.287416
&quot;G-Depth_NS&quot; 0.992066 0.079908  0.988406  0.716249  1.278825
&quot;HP_error&quot;  -4.476037 0.005409 -4.476034 -4.499176 -4.452572
&quot;HP_S-NTD&quot;  -4.069963 0.036324 -4.071082 -4.208769 -3.924772</code></pre>
<div class=importantv >fno5: Acceptance ratio &#40;&quot;acceptance.out&quot; by default&#41;</div>
<div class=important >&#36; cat acceptance.out</div>
<pre><code class="plaintext hljs">Acceptance_ratio: 0.273325</code></pre>
<p>Note that it is plausible to adjust the pertubation widths as the acceptance ratio is ~23 &#37; when sampling multiple parameters &#40;<a href="https://global.oup.com/academic/product/bayesian-statistics-5-9780198523567?cc&#61;jp&amp;lang&#61;en&amp;#">Gelman et al., 1996</a>&#41;</p>
<div class=importantv >fno6: Data residuals including the NTD and gradient effects &#40;&quot;residual&#95;sdls.out&quot; by default&#41;</div>
<p>The effects of the modeled NTD and gradients on the data residuals are shown.</p>
<ul>
<li><p>1: The cumulative seconds of the observational time</p>

<li><p>2: Seafloor transponder number</p>

<li><p>3: EW sea-surface platform positions</p>

<li><p>4: NS sea-surface platform positions</p>

<li><p>5: UD sea-surface platform positions</p>

<li><p>6: The projected travel-time residuals &#40;OBS-SYN&#41;</p>

<li><p>7: The modeled travel time delay &#40;L-NTD &#43; S-NTD &#43; S-GRAD &#43; D-GRAD&#41;</p>

<li><p>8: The final travel time redidual &#40;OBS - SYN - L-NTD -S-NTD - S-GRAD - D-GRAD&#41;</p>

<li><p>9: The modeled travel time delay due to S-GRAD</p>

<li><p>10: The modeled travel time delay due to D-GRAD</p>

<li><p>11: The modeled L-NTD</p>

<li><p>12: The modeled S-NTD</p>

<li><p>13: The modeled shallow gradient &#40;EW&#41;</p>

<li><p>14: The modeled shallow gradient &#40;NS&#41;</p>

<li><p>15: The modeled depth gradient &#40;EW&#41;</p>

<li><p>16: The modeled depth gradient &#40;NS&#41;</p>

<li><p>17: Identifying number for the sea surface platform</p>

</ul>
<div class=important >&#36; head residual&#95;sdls.out</div>
<pre><code class="plaintext hljs">500664440.09 4 113.063 96.439 15.728 1.8608e-03 1.8747e-03 -1.3857e-05 5.6408e-06 -3.3816e-05 1.8962e-03 6.6428e-06 -5.8132e-05 1.2664e-04 0.952 1.018 1
500664920.02 1 317.259 266.201 16.123 1.9466e-03 1.9629e-03 -1.6271e-05 1.4608e-05 9.6998e-06 1.8952e-03 4.3393e-05 -5.8905e-05 1.2508e-04 0.951 1.018 1
500664920.23 3 317.417 266.241 16.278 1.9071e-03 1.9375e-03 -3.0447e-05 1.4603e-05 -1.5645e-05 1.8952e-03 4.3402e-05 -5.8906e-05 1.2508e-04 0.951 1.018 1
500664920.11 4 317.327 266.218 16.190 1.9720e-03 1.9177e-03 5.4309e-05 1.4606e-05 -3.5459e-05 1.8952e-03 4.3397e-05 -5.8905e-05 1.2508e-04 0.951 1.018 1
500664980.01 1 359.357 277.174 15.412 1.9618e-03 1.9636e-03 -1.8167e-06 1.3411e-05 9.8400e-06 1.8950e-03 4.5380e-05 -5.9003e-05 1.2488e-04 0.951 1.018 1
500664980.24 3 359.624 277.195 15.512 1.9099e-03 1.9384e-03 -2.8467e-05 1.3397e-05 -1.5400e-05 1.8950e-03 4.5386e-05 -5.9004e-05 1.2488e-04 0.951 1.018 1
500664980.10 4 359.467 277.182 15.454 1.9598e-03 1.9185e-03 4.1225e-05 1.3405e-05 -3.5254e-05 1.8950e-03 4.5383e-05 -5.9004e-05 1.2488e-04 0.951 1.018 1
500665039.99 1 418.964 300.259 15.697 1.9330e-03 1.9635e-03 -3.0459e-05 1.2676e-05 9.8785e-06 1.8949e-03 4.6054e-05 -5.9102e-05 1.2468e-04 0.951 1.018 1
500665040.26 3 419.239 300.462 15.709 1.9137e-03 1.9384e-03 -2.4620e-05 1.2685e-05 -1.5255e-05 1.8949e-03 4.6053e-05 -5.9102e-05 1.2468e-04 0.951 1.018 1
500665040.10 4 419.074 300.338 15.702 1.9324e-03 1.9185e-03 1.3929e-05 1.2679e-05 -3.5137e-05 1.8949e-03 4.6054e-05 -5.9102e-05 1.2468e-04 0.951 1.018 1</code></pre>
<div class=importantv >fno7: &#40;&quot;bspline&#95;gradv.out&quot; by default&#41;</div>
<p>The modeled sound speed parameters expanded by 3d B-spline functions are shown.</p>
<ul>
<li><p>1: The cumulative seconds of the observational time</p>

<li><p>2: The modeled L-NTD</p>

<li><p>3: The modeled S-NTD</p>

<li><p>4: The modeled shallow gradient &#40;EW&#41;</p>

<li><p>5: The modeled shallow gradient &#40;NS&#41;</p>

<li><p>6: The modeled depth gradient &#40;EW&#41;</p>

<li><p>7: The modeled depth gradient &#40;NS&#41;</p>

</ul>
<div class=important >&#36; head bspline&#95;gradv.out</div>
<pre><code class="plaintext hljs">500664440.09 1.8962e-03 6.6428e-06 -5.8132e-05 1.2664e-04 0.952 1.018
500664920.02 1.8952e-03 4.3393e-05 -5.8905e-05 1.2508e-04 0.951 1.018
500664920.23 1.8952e-03 4.3402e-05 -5.8906e-05 1.2508e-04 0.951 1.018
500664920.11 1.8952e-03 4.3397e-05 -5.8905e-05 1.2508e-04 0.951 1.018
500664980.01 1.8950e-03 4.5380e-05 -5.9003e-05 1.2488e-04 0.951 1.018
500664980.24 1.8950e-03 4.5386e-05 -5.9004e-05 1.2488e-04 0.951 1.018
500664980.10 1.8950e-03 4.5383e-05 -5.9004e-05 1.2488e-04 0.951 1.018
500665039.99 1.8949e-03 4.6054e-05 -5.9102e-05 1.2468e-04 0.951 1.018
500665040.26 1.8949e-03 4.6053e-05 -5.9102e-05 1.2468e-04 0.951 1.018
500665040.10 1.8949e-03 4.6054e-05 -5.9102e-05 1.2468e-04 0.951 1.018</code></pre>
<div class=importantv >fno8: &#40;&quot;gradient.out&quot; by default&#41;</div>
<p>Temporally-averaged gradient parameters are written.</p>
<div class=important >&#36; cat gradient.out</div>
<pre><code class="plaintext hljs"># S-Grad(EW), S-Grad(NS) D-Grad(EW) D-Grad(NS) Grad-Depth(Ave, EW, NS)
-6.102525963022871e-5 0.00013714561503948663 -2.910080825256518e-5 6.802876009425737e-5 0.9537299285212764 0.9920661345923557 0.9755164725928644</code></pre>
<div class=importantv >fno9: &#40;&quot;initial.out&quot; by default&#41;</div>
<p>The updated Initial value parameter file: Temporal perturbations of S-NTD, S-Grad are randomly introduced</p>
<div class=important >&#36; head -n 20 initial.out</div>
<pre><code class="plaintext hljs">0.025410462308784486 0.0003285916454800491 EW_disp.
-0.01569704833998688 0.00032709528235116216 NS_disp.
-0.03417871494024675 0.00119971349382272 UD_disp.
-8.37248428698407e-5 2.0e-6 S-Grad_EW
8.89971826238189e-5 2.0e-6 S-Grad_NS
0.0 0.01 G-Depth_EW
0.0 0.01 G-Depth_NS
-4.0 0.005 HP_error
-4.5 0.005 HP_S-NTD
-4.5 0.005 HP_S-Grad
-1.0 0.005 HP_G-Depth
0.001885751243719274 2.0e-6 L-NTD_1
0.0019299017374440242 2.0e-6 L-NTD_2
0.0017720436581544553 2.0e-6 L-NTD_3
0.0024791239571273424 2.0e-6 L-NTD_4
0.005824457411845061 2.0e-6 L-NTD_5
4.326134026356776e-5 2.0e-6 S-NTD_1
-6.415872683524214e-6 2.0e-6 S-NTD_2
-5.746630455504518e-5 2.0e-6 S-NTD_3
-7.268619164991716e-6 2.0e-6 S-NTD_4</code></pre>
<h2 id=visualization ><a href="#visualization" class=header-anchor >Visualization</a></h2>
<p>SeaGap prepares various functions to visualize results of the MCMC processing.</p>
<h3 id=posterior_pdf_and_rms_variation_through_the_mcmc_iteration ><a href="#posterior_pdf_and_rms_variation_through_the_mcmc_iteration" class=header-anchor >Posterior PDF and RMS variation through the MCMC iteration</a></h3>
<p>When you&#39;d like to check how the posterior probability density and the projected travel-time RMS change through the MCMC iteration, you can draw by <code>plot_mcmcres&#40;;fn,fno,show,nshuffle&#41;</code>. </p>
<ul>
<li><p>fn: the input file name &#40;<code>fn&#61;&quot;mcmc.out&quot;</code> by default&#41;</p>

<li><p>fno: Output figure name &#40;<code>fno&#61;&quot;mcmc_res.pdf&quot;</code> by default&#41;</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

<li><p>nshuffle: number of plots &#40;if all samples are plotted, the figure is crowded; thus, <code>nshuffle</code> of samples are randomly picked; if <code>nshuffle&#61;0</code>, all samples are plotted; <code>nshuffle&#61;50000</code> by default&#41;</p>

</ul>
<p>You can adjust the fontsizes or figuresize by the other arguments.</p>
<pre><code class="julia hljs">SeaGap.plot_mcmcres(fno=<span class=hljs-string >&quot;mcmc_res.pdf&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/mcmc_res.png" width=350  height=350 >
    <div style="clear: both"></div>
  </div>
</div>

<h3 id=parameter_variation_through_the_mcmc_iteration ><a href="#parameter_variation_through_the_mcmc_iteration" class=header-anchor >Parameter variation through the MCMC iteration</a></h3>
<p>When you&#39;d like to check how the unknown parameters change through the MCMC iteration, you can draw by <code>plot_mcmcparam_gradv&#40;NA;fn,fno,show,nshuffle&#41;</code>.</p>
<ul>
<li><p>NA: Sampling interval of the MCMC prcessing &#40;<code>NA&#61;5</code> by default&#41;, which must be same with <code>NA</code> in <code>static_array_mcmcgradv</code></p>

<li><p>fn: the input file name &#40;<code>fn&#61;&quot;sample.out&quot;</code> by default&#41;</p>

<li><p>fno: Output figure name &#40;<code>fno&#61;&quot;mcmc_param.pdf&quot;</code> by default&#41;</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

<li><p>nshuffle: number of plots for each parameter &#40;if all samples are plotted, the figure is crowded; thus, <code>nshuffle</code> of samples are randomly picked; if <code>nshuffle&#61;0</code>, all samples are plotted; <code>nshuffle&#61;10000</code> by default&#41;</p>

</ul>
<p>You can adjust the fontsizes or figuresize by the other arguments.</p>
<pre><code class="julia hljs">SeaGap.plot_mcmcparam_gradv(<span class=hljs-number >5</span>,fno=<span class=hljs-string >&quot;mcmc_param.pdf&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/mcmc_param.png" width=600  height=600 >
    <div style="clear: both"></div>
  </div>
</div>

<p>In this function, major six unknown parameters are shown. If you&#39;d like to draw a figure for the other paramters, you can use <code>plot_mcmcparam_each&#40;param,NA;fn,fno,show,nshuffle&#41;</code>. <code>param</code> is the parameter name written in &quot;initial.inp&quot;.</p>
<pre><code class="julia hljs">SeaGap.plot_mcmcparam_each(<span class=hljs-string >&quot;S-NTD_10&quot;</span>,<span class=hljs-number >5</span>,fno=<span class=hljs-string >&quot;mcmc_param_S-NTD_10.png&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/mcmc_param_S-NTD_10.png" width=150  height=150 >
    <div style="clear: both"></div>
  </div>
</div>

<h3 id=correlation_among_the_unknown_parameters ><a href="#correlation_among_the_unknown_parameters" class=header-anchor >Correlation among the unknown parameters</a></h3>
<p>When you&#39;d like to simply check the trade-off relationship among the unknown parameters, you can draw a correlation map by <code>plot_cormap_gradv&#40;fn,fno0,fno,show,txt,all,as,pfs,plot_size&#41;</code>.</p>
<ul>
<li><p>fn: the input file name &#40;<code>fn&#61;&quot;sample.out&quot;</code> by default&#41;</p>

<li><p>fno0: Output text data file name &#40;if <code>txt&#61;true</code>, correlation coefficients are save in this file; <code>fno0&#61;&quot;correlation.out&quot;</code>&#41;</p>

<li><p>fno: Output figure name &#40;<code>fno&#61;&quot;cormap.pdf&quot;</code> by default&#41;</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

<li><p>txt: Text data file output &#40;<code>txt&#61;false</code> by default&#41;</p>

<li><p>all: if <code>all&#61;true</code>, correlation coefficients are calculated for all parameters; if <code>all&#61;false</code>, correlation coefficients are calculated for major paramters &#40;array displacements, shallow gradients, gradient depth&#41;</p>

<li><p>as: Fontsize of parameter names &#40;<code>as&#61;10</code> by default&#41;</p>

<li><p>pfs: Fontsize of annotated correlation values &#40;<code>pfs&#61;8</code> by default&#41;</p>

<li><p>plot&#95;size: Figure size &#40;<code>plot_size&#61;&#40;&#41;</code> by default&#41;</p>

</ul>
<pre><code class="julia hljs">SeaGap.plot_cormap_gradv(fno=<span class=hljs-string >&quot;cormap.png&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/cormap.png" width=450  height=450 >
    <div style="clear: both"></div>
  </div>
</div>

<div class=important >&#36; head -n 7 correlation.out | awk &#39;&#123;print &#36;1,&#36;2,&#36;3,&#36;4,&#36;5,&#36;6,&#36;7&#125;&#39;</div>
<pre><code class="plaintext hljs">Name: EW_disp. NS_disp. UD_disp. S-Grad_EW S-Grad_NS G-Depth_EW
&quot;EW_disp.&quot; 1.0 -0.3356124991185022 -0.23515279880381532 -0.3803514391901573 -0.011409026075565506 0.5828230015324758
&quot;NS_disp.&quot; -0.3356124991185022 1.0 0.37266487444226404 0.3549474663596853 -0.006429289222325339 -0.39833730865946165
&quot;UD_disp.&quot; -0.23515279880381532 0.37266487444226404 1.0 0.05928566131657452 -0.01530484319231686 -0.21752009435257144
&quot;S-Grad_EW&quot; -0.3803514391901573 0.3549474663596853 0.05928566131657452 1.0 0.42961339278338556 0.03768990735893968
&quot;S-Grad_NS&quot; -0.011409026075565506 -0.006429289222325339 -0.01530484319231686 0.42961339278338556 1.0 -0.07774179162939017
&quot;G-Depth_EW&quot; 0.5828230015324758 -0.39833730865946165 -0.21752009435257144 0.03768990735893968 -0.07774179162939017 1.0</code></pre>
<h3 id=histogram_for_each_unknown_parameter ><a href="#histogram_for_each_unknown_parameter" class=header-anchor >Histogram for each unknown parameter</a></h3>
<p>From the MCMC samples &#40;&quot;sample.out&quot;&#41;, you can draw a histogram for each unknown parameter by <code>plot_histogram_gradv&#40;NPB1,NPB2,NPB3,NPB4;fn0,fn,fno,all,drawnls,nbins&#41;</code>.</p>
<ul>
<li><p>NPB1: Number of 3d B-spline bases for L-NTD</p>

<li><p>NPB2: Number of 3d B-spline bases for S-NTD</p>

<li><p>NPB3: Number of 3d B-spline bases for S-Grad</p>

<li><p>NPB4: Number of 3d B-spline bases for G-Depth</p>

<li><p>fn0: Inversion results by <code>static_array&#40;&#41;</code> &#40;&quot;solve.out&quot; by default&#41;, which is used when you&#39;d like to plot the <code>static_array&#40;&#41;</code> results on the histogram</p>

<li><p>fn: Input file &#40;&quot;sample.out&quot; by default&#41;</p>

<li><p>fno: Output figure name &#40;note that this file must be a PDF file: &quot;histogram.pdf&quot; by default&#41;</p>

<li><p>all: if <code>all&#61;true</code>, histograms for all parameters are drawn; if <code>all&#61;false</code>, histograms for major six parameters &#40;array displacements, shallow gradients, gradient depth&#41; &#40;<code>all&#61;false</code> by default&#41;</p>

<li><p>drawnls: if <code>drawnls&#61;true</code>, a normal distribution estimated by <code>static_array&#40;&#41;</code> is drawn in a histogram &#40;<code>drawnls&#61;false</code> by default&#41;; the normal distributions are shown for the array displacements and 3d B-spline NTDs. Note that you cannot use this option when <code>all&#61;true</code>.</p>

<li><p>nbins: Number of histogram&#39;s intervals &#40;<code>nbins&#61;50</code> by default&#41;</p>

</ul>
<pre><code class="julia hljs">SeaGap.plot_histogram(<span class=hljs-number >77</span>,all=<span class=hljs-literal >true</span>,fno=<span class=hljs-string >&quot;histogram_all.pdf&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/histogram_all.jpg" width=400  height=400 >
    <div style="clear: both"></div>
  </div>
</div>

<pre><code class="julia hljs">SeaGap.plot_histogram(<span class=hljs-number >77</span>,all=<span class=hljs-literal >true</span>,fno=<span class=hljs-string >&quot;histogram_allv.pdf&quot;</span>,drawnls=<span class=hljs-literal >true</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/histogram_allv.jpg" width=400  height=400 >
    <div style="clear: both"></div>
  </div>
</div>

<h3 id=histograms_and_heatmaps_for_multiple_parameters ><a href="#histograms_and_heatmaps_for_multiple_parameters" class=header-anchor >Histograms and heatmaps for multiple parameters </a></h3>
<p>Using <code>plot_histogram2d&#40;fn,fno,show,nshufflei,nbins&#41;</code>, you can draw a figure showing histograms, heatmaps, and scatter maps for major six parameters &#40;array displacements, shallow gradients, gradient depth&#41;.</p>
<ul>
<li><p>fn: Input file &#40;&quot;sample.out&quot; by default&#41;</p>

<li><p>fno: Output figure name</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

<li><p>nshuffle: number of plots for each parameter &#40;if all samples are plotted, the figure is crowded; thus, <code>nshuffle</code> of samples are randomly picked; if <code>nshuffle&#61;0</code>, all samples are plotted; <code>nshuffle&#61;10000</code> by default&#41;</p>

<li><p>nbins: Number of histogram&#39;s intervals &#40;<code>nbins&#61;50</code> by default&#41;</p>

</ul>
<p>You can adjust fontsizes, margins of panels, and figure size by the other arguments. </p>
<pre><code class="julia hljs">SeaGap.plot_histogram2d(fno=<span class=hljs-string >&quot;histogram2d.pdf&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/histogram2d.png" width=500  height=500 >
    <div style="clear: both"></div>
  </div>
</div>

<p>Diagonal panels show histograms for individual parameter. Upper triangle panels show scatter maps for corresponding two parameters. Lower triangle panels show heat maps for corresponding two parameters.</p>
<p>If you&#39;d like to draw a heatmap for certain two parameters, you can make it by <code>plot_histogram2d_each&#40;param1,param2,fn,fno,show,nbins&#41;</code>. <code>param1</code> and <code>param2</code> are the parameter names written in &quot;initial.inp&quot;.</p>
<pre><code class="julia hljs">SeaGap.plot_histogram2d_each(<span class=hljs-string >&quot;UD_disp.&quot;</span>,<span class=hljs-string >&quot;S-NTD_10&quot;</span>,fno=<span class=hljs-string >&quot;histogram2d_UD_SNTD-10.png&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/histogram2d_UD_SNTD-10.png" width=350  height=350 >
    <div style="clear: both"></div>
  </div>
</div>

<h3 id=spatial_variation_of_travel-time_residuals_shallow_gardient ><a href="#spatial_variation_of_travel-time_residuals_shallow_gardient" class=header-anchor >Spatial variation of travel-time residuals &#40;shallow gardient&#41;</a></h3>
<p><code>plot_gradmap&#40;xrange,yrange;autoscale,fn1,fn2,fno,show&#41;</code> draws a sea-surface platform track with color of the spatial variation due to the shallow gradients &#40;the projected travel time residuals - L-NTD - S-NTD - D-Grad&#41;.</p>
<ul>
<li><p>xrange: Range of EW component in meters when <code>autoscale&#61;false</code></p>

<li><p>yrange: Range of NS component in meters when <code>autoscale&#61;false</code></p>

<li><p>autoscale: If <code>autoscale&#61;true</code>, the plot range is automatically defined</p>

<li><p>fn1: File name of the seafloor transponder positions &#40;&quot;pxp-ini.inp&quot;&#41;  </p>

<li><p>fn2: Travel-time residual file name &#40;&quot;residual&#95;sdls.out&quot;&#41;</p>

<li><p>fno: Output figure name &#40;&quot;gradmap.pdf&quot; by default&#41;</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

</ul>
<pre><code class="julia hljs">SeaGap.plot_gradmap_gradv((-<span class=hljs-number >2500</span>,<span class=hljs-number >2500</span>),(-<span class=hljs-number >2500</span>,<span class=hljs-number >2500</span>),autoscale=<span class=hljs-literal >false</span>,fno=<span class=hljs-string >&quot;gradmap.png&quot;</span>)</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/gradmap.png" width=400  height=400 >
    <div style="clear: both"></div>
  </div>
</div>

<h3 id=temporal_variation_of_the_travel-time_residuals ><a href="#temporal_variation_of_the_travel-time_residuals" class=header-anchor >Temporal variation of the travel-time residuals</a></h3>
<p>Time-series of the travel-time residuals are plotted by <code>plot_ntd_gradv&#40;ntdrange,resrange;autoscale,fn,fno,show&#41;</code>.</p>
<ul>
<li><p>ntdrange: Range of the upper two panels in msec when <code>autoscale&#61;false</code></p>

<li><p>resrange: Range of the lowest panels in msec when <code>autoscale&#61;false</code></p>

<li><p>autoscale: If <code>autoscale&#61;true</code>, the plot range is automatically defined</p>

<li><p>fn: Travel-time residual file name &#40;&quot;residual&#95;sdls.out&quot;&#41;</p>

<li><p>fno: Output figure name &#40;&quot;ntdgrad.pdf&quot; by default&#41;</p>

<li><p>show: if <code>show&#61;true</code>, a figure is shown on REPL and is not saved as a file &#40;<code>show&#61;false</code> by default&#41;</p>

</ul>
<pre><code class="julia hljs">SeaGap.plot_ntd_gradv()</code></pre>

<div class=row >
  <div class=container >
    <img src="/SeaGapDocs/assets/ntdgrad.png" width=600  height=600 >
    <div style="clear: both"></div>
  </div>
</div>

<p>The upper panel shows the projected travel-time residuals by cross symbols. Moreover, black dots show combination of the 3d B-splined NTD and the deep gradient contribution.</p>
<p>The middle panel shows the projected travel-time residuals subtracting the deep gradient contribution by cross symbols. Moreover, the 3d B-splined NTD, the long-term NTD, and combination of the long-term NTD and the shallow gradients are shown by black, red, and blue curves, respecively.</p>
<p>The lower panel shows the final travel-time residuals.</p>
<div class=page-foot >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Fumiaki Tomita. Last modified: July 03, 2024.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div>
  </main> 
  <script src="/SeaGapDocs/libs/vela/metisMenu.min.js"></script>
  <script src="/SeaGapDocs/libs/vela/slideout.min.js"></script>
  
  
    <script src="/SeaGapDocs/libs/highlight/highlight.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>